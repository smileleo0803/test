/*2020/03HNW共1,284人*/
select count(*),count(customer_id),count(distinct customer_id) 
from temp_bps.wm_segment_2003
where segment = '01.HNW'


/*2020/03HNW共1,284人串企業戶  count(*)=1584*/
select * 
from temp_bps.wm_segment_2003 base
left join  
(
(select sme_id , smeo_id ,'個金既有戶'as base_flag ,channel_code 
 from temp_analysisdev.Z35615_SMEBase_2003 where length(sme_id) = 8 ) --SME既有戶
union
(select customer_id as sme_id , Resp_Customer_ID as smeo_id ,'法金既有戶'as base_flag ,'VC' as channel_code 
 from vc_bns_mcif.bns_customer 
 where Resp_Customer_ID is not null and length(customer_id) = 8 and customer_id not in (select distinct sme_id from temp_analysisdev.Z35615_SMEBase_2003)) --法金既有戶
union
(select comp_id as sme_id , cust_id as smeo_id , '潛力戶' as base_flag , '潛力戶' as channel_code from temp_analysisdev.Z35615_SB_greatlist_20200121 --10W潛力戶
 where waterfall in ('99_符合名單')
    and comp_id not in (select customer_id from vr_bns_mcif.bns_customer)
    and comp_id not in (select customer_id from vc_bns_mcif.bns_customer)	--排除舊戶
	and comp_id not in (select sme_id from temp_analysisdev.Z35615_SMEBase_2003)  --行內既有戶
	and comp_id not in (select customer_id from temp_corporate.weekly_cif_snapshot)
	and length(comp_id) = 8) --法金認養戶
) company on base.customer_id = smeo_id
where segment = '01.HNW'



/*2020/03HNW共1,284人計算戶數、人數*/
select count(*) , customer_id ,count(distinct customer_id),count(sme_id),count(distinct sme_id),count(smeo_id),count(distinct smeo_id),max(base_flag)
from (
select * 
from temp_bps.wm_segment_2003 base
left join  
(
(select sme_id , smeo_id ,'個金既有戶'as base_flag ,channel_code 
 from temp_analysisdev.Z35615_SMEBase_2003 where length(sme_id) = 8 ) --SME既有戶
union
(select customer_id as sme_id , Resp_Customer_ID as smeo_id ,'法金既有戶'as base_flag ,'VC' as channel_code 
 from vc_bns_mcif.bns_customer 
 where Resp_Customer_ID is not null and length(customer_id) = 8 and customer_id not in (select distinct sme_id from temp_analysisdev.Z35615_SMEBase_2003)) --法金既有戶
union
(select comp_id as sme_id , cust_id as smeo_id , '潛力戶' as base_flag , '潛力戶' as channel_code from temp_analysisdev.Z35615_SB_greatlist_20200121 --10W潛力戶
 where waterfall in ('99_符合名單')
    and comp_id not in (select customer_id from vr_bns_mcif.bns_customer)
    and comp_id not in (select customer_id from vc_bns_mcif.bns_customer)	--排除舊戶
	and comp_id not in (select sme_id from temp_analysisdev.Z35615_SMEBase_2003)  --行內既有戶
	and comp_id not in (select customer_id from temp_corporate.weekly_cif_snapshot)
	and length(comp_id) = 8) --法金認養戶
) company on base.customer_id = smeo_id
where segment = '01.HNW'
) tt
where sme_id is not null and length(customer_id) <> 8  --自然人有搭配到企業
group by customer_id

/*HNW簡報數字*/
/*2020/03HNW共1,284人計算戶數、人數*/
select customer_id ,sme_id ,base_flag
from (
select * 
from temp_bps.wm_segment_2003 base
left join  
(
(select sme_id , smeo_id ,'個金既有戶'as base_flag ,channel_code 
 from temp_analysisdev.Z35615_SMEBase_2003 where length(sme_id) = 8 ) --SME既有戶
union
(select customer_id as sme_id , Resp_Customer_ID as smeo_id ,'法金既有戶'as base_flag ,'VC' as channel_code 
 from vc_bns_mcif.bns_customer 
 where Resp_Customer_ID is not null and length(customer_id) = 8 and customer_id not in (select distinct sme_id from temp_analysisdev.Z35615_SMEBase_2003)) --法金既有戶
union
(select comp_id as sme_id , cust_id as smeo_id , '潛力戶' as base_flag , '潛力戶' as channel_code from temp_analysisdev.Z35615_SB_greatlist_20200121 --10W潛力戶
 where waterfall in ('99_符合名單')
    and comp_id not in (select customer_id from vr_bns_mcif.bns_customer)
    and comp_id not in (select customer_id from vc_bns_mcif.bns_customer)	--排除舊戶
	and comp_id not in (select sme_id from temp_analysisdev.Z35615_SMEBase_2003)  --行內既有戶
	and comp_id not in (select customer_id from temp_corporate.weekly_cif_snapshot)
	and length(comp_id) = 8) --法金認養戶
) company on base.customer_id = smeo_id
where segment = '01.HNW'
) tt
where sme_id is not null and length(customer_id) <> 8  --自然人有搭配到企業
--group by customer_id