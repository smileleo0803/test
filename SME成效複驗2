select count(Account_Nbr) ,count(distinct Account_Nbr)
from 
(select customer_id ,  Account_Nbr ,  Approval_Date, Application_Date ,Approval_Amt , Application_Amt ,Current_Bal, Acct_Status_Code 
 from vp_bns_mcif.bns_loan
 where Application_Date <= Approval_Date )--where Acct_Status_Code not in ('40') )
union 
(select customer_id ,  Account_Nbr , Application_Date ,  Approval_Date , Application_Amt ,Approval_Amt ,Current_Bal, Acct_Status_Code 
 from vc_bns_mcif.bns_loan
 where Application_Date <= Approval_Date ) --where Acct_Status_Code not in ('40') )
 ) l
 
 
 
 
select *
from (
/*已出過名單*/
	(select distinct sb_id as sme_id , 'SCC_5371' as project_name from temp_analysisdev.SCC_list1) --SCC第一波(5,371筆)
	union 
	(select distinct customer_id as sme_id , 'SCC_4040' as project_name from temp_analysisdev.SCC_list2 ) -- SCC2第二波(4,040筆)
	union
	(select distinct sme_id , 'SCC_2470' as project_name from temp_analysisdev.SCC_2470) -- SCC(2,470筆)
	union
	(select distinct comp_id as sme_id , 'ECC_105' as project_name from temp_analysisdev.Z44721_SB_FAlist_20200102 ) -- ECC(105筆)
	union
	(select distinct sd_id as sme_id , 'ECC_119' as project_name from temp_analysisdev.Z44721_faecc_list_info )  -- ECC(119筆)
	union 
	(select distinct "公司統編" as sme_id  , 'SCC_7000' as project_name from temp_analysisdev.Z35615_SCC_24000_v1) --SCC(7,000筆))
	) b
left join 
(
(select customer_id ,  Account_Nbr , max(Approval_Date) as Approval_Date  
 from vp_bns_mcif.bns_loan
 where Application_Date <= Approval_Date
 and Acct_Status_Code not in ('40') 
 and Bad_Debit_Code in ('00','30','40','90')
 group by customer_id ,  Account_Nbr )--where Acct_Status_Code not in ('40') )
union 
(select customer_id ,  Account_Nbr , max(Approval_Date) as Approval_Date
 from vc_bns_mcif.bns_loan
 where Application_Date <= Approval_Date
 and Acct_Status_Code not in ('40')
 and Bad_Debit_Code in ('00','30','40','90')
 group by customer_id ,  Account_Nbr ) --where Acct_Status_Code not in ('40') )
 ) base 
 on b.sme_id = base.customer_id
 left join (
 (select customer_id ,  Account_Nbr ,Approval_Date, Application_Date ,Approval_Amt , Application_Amt ,Current_Bal, Acct_Status_Code
 from vp_bns_mcif.bns_loan where Acct_Status_Code not in ('40') and Bad_Debit_Code in ('00','30','40','90') )
 union 
 (select customer_id ,  Account_Nbr ,Approval_Date, Application_Date ,Approval_Amt , Application_Amt ,Current_Bal, Acct_Status_Code
 from vc_bns_mcif.bns_loan where Acct_Status_Code not in ('40') and Bad_Debit_Code in ('00','30','40','90') ) 
 ) a
 on base.customer_id = a.customer_id and base.Account_Nbr = a.Account_Nbr and base.Approval_Date = a.Approval_Date
 
 
 where Approval_Date >= 1191101
 
